<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Drawable Canvas</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 20px;
      }

      canvas {
        border: 1px solid #000;
        cursor: pointer;
      }

      #output,
      #outputCpp {
        margin-top: 20px;
        white-space: pre;
        font-family: monospace;
        word-wrap: break-word;
        text-align: left;
      }

      #loadBitmap {
        margin-top: 20px;
      }

      #toolSection {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Drawable Canvas</h1>

    <canvas id="canvas" width="1200" height="320"></canvas>

    <!-- Pencil and Eraser Tool Section -->
    <div id="toolSection">
      <button id="pencilTool">Pencil</button>
      <button id="eraserTool">Eraser</button>
    </div>

    <!-- Input for loading a bitmap -->
    <div id="loadBitmap">
      <textarea
        id="bitmapInput"
        rows="6"
        cols="60"
        placeholder="Enter bitmap data (e.g. 0 1 0 1... per row)"
      ></textarea
      ><br />
      <button onclick="loadBitmap()">Load Bitmap</button>
    </div>

    <div id="output"></div>
    <div id="outputCpp"></div>

    <script>
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const width = canvas.width;
      const height = canvas.height;
      const pixelSize = 10; // Size of each pixel in the canvas

      let canvasState = Array.from({ length: height / pixelSize }, () =>
        Array(width / pixelSize).fill(0)
      );
      let currentTool = "pencil"; // Default tool

      // Draw the canvas based on the state array
      function drawCanvas() {
        ctx.clearRect(0, 0, width, height);
        for (let y = 0; y < height / pixelSize; y++) {
          for (let x = 0; x < width / pixelSize; x++) {
            ctx.fillStyle = canvasState[y][x] === 0 ? "black" : "white";
            ctx.fillRect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
          }
        }
      }

      function outputCanvasState() {
        const outputArray = canvasState.map((row) => row.join(""));
        const cppOutputArray = outputArray.map((l) =>
          l
            .split("")
            .map((c, index) => {
              if (index % 8 === 0) {
                return `0b${c}`;
              }

              if (index % 8 === 7) {
                return `${c},`;
              }

              return c;
            })
            .join("")
        );
        document.getElementById("output").textContent = outputArray.join("\n");
        document.getElementById("outputCpp").textContent =
          cppOutputArray.join("\n");
      }

      canvas.addEventListener("click", (e) => {
        const x = Math.floor(e.offsetX / pixelSize);
        const y = Math.floor(e.offsetY / pixelSize);

        if (currentTool === "pencil") {
          canvasState[y][x] = 1;
        } else if (currentTool === "eraser") {
          canvasState[y][x] = 0;
        }

        drawCanvas();
        outputCanvasState();
      });

      function loadBitmap() {
        const bitmapInput = document.getElementById("bitmapInput").value.trim();
        const rows = bitmapInput
          .split("\n")
          .map((row) => row.trim().split("").map(Number));

        if (
          rows.length !== canvasState.length ||
          rows.some((row) => row.length !== canvasState[0].length)
        ) {
          alert("Bitmap size does not match canvas size!");
          return;
        }

        canvasState = rows;
        drawCanvas();
        outputCanvasState();
      }

      document.getElementById("pencilTool").addEventListener("click", () => {
        currentTool = "pencil";
      });

      document.getElementById("eraserTool").addEventListener("click", () => {
        currentTool = "eraser";
      });

      drawCanvas();
      outputCanvasState();
    </script>
  </body>
</html>
